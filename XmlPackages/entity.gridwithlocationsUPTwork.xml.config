<?xml version="1.0" standalone="yes" ?>
<package version="2.1" displayname="Entity Grid" debug="false" includeentityhelper="true">

  <!-- ###################################################################################################### -->
  <!-- Copyright AspDotNetStorefront.com, 1995-2007.  All Rights Reserved.					                -->
  <!-- http://www.aspdotnetstorefront.com														                -->
  <!-- For details on this license please visit  the product homepage at the URL above.		                -->
  <!-- THE ABOVE NOTICE MUST REMAIN INTACT.                                                                   -->
  <!-- $Header: /v6.1/Web/XmlPackages/entity.grid.xml.config 1     12/30/05 2:33p Administrator $	            -->
  <!--                                                                                                        -->
  <!-- ###################################################################################################### -->


  <query name="Products" rowElementName="Product">
    <sql>
      <![CDATA[
                 exec aspdnsf_GetProductsWithSection
                      @categoryID = @CatID,
					  @pagenum = @pgnum,
					  @pagesize = 51,
					  @order = @sort
            ]]>
    </sql>
	<queryparam paramname="@sort" paramtype="runtime" requestparamname="SortOrder" sqlDataType="varchar" defvalue="DESC"  validationpattern="" />
	<queryparam paramname="@CatID" paramtype="runtime" requestparamname="CatID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@SecID" paramtype="runtime" requestparamname="SecID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@ManID" paramtype="runtime" requestparamname="ManID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@DistID" paramtype="runtime" requestparamname="DistID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@GenreID" paramtype="runtime" requestparamname="GenreID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@VectorID" paramtype="runtime" requestparamname="VectorID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@locale" paramtype="runtime" requestparamname="LocaleSetting" sqlDataType="varchar" defvalue="en-US"  validationpattern="" />
    <queryparam paramname="@CustLevelID" paramtype="runtime" requestparamname="CustomerLevelID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@AffID" paramtype="runtime" requestparamname="AffiliateID" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@ProdTypeID" paramtype="runtime" requestparamname="ProductTypeFilterID" sqlDataType="int" defvalue="1"  validationpattern="" />
    <queryparam paramname="@pgnum" paramtype="request" requestparamname="pagenum" sqlDataType="int" defvalue="1"  validationpattern="" />
    <queryparam paramname="@InvFilter" paramtype="appconfig" requestparamname="HideProductsWithLessThanThisInventoryLevel" sqlDataType="int" defvalue="0"  validationpattern="" />
    <queryparam paramname="@entityname" paramtype="runtime" requestparamname="EntityName" sqlDataType="varchar" defvalue=""  validationpattern="" />
  </query>

  <PackageTransform>

    <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                    xmlns:aspdnsf="urn:aspdnsf" exclude-result-prefixes="aspdnsf">
      <xsl:output method="html" omit-xml-declaration="yes" />

      <xsl:param name="LocaleSetting" select="/root/Runtime/LocaleSetting" />
      <xsl:param name="WebConfigLocaleSetting" select="/root/Runtime/WebConfigLocaleSetting" />
      <xsl:param name="ShowSubcatsInGrid">
        <xsl:value-of select="aspdnsf:AppConfig('ShowSubcatsInGrid')" />
      </xsl:param>
      <xsl:param name="SubcatGridCols">
        <xsl:value-of select="/root/EntityHelpers/*[name()=/root/Runtime/EntityName]/descendant::Entity[EntityID=/root/Runtime/EntityID]/ColWidth" />
      </xsl:param>
      <xsl:param name="EntityName">
        <xsl:value-of select="/root/Runtime/EntityName" />
      </xsl:param>
      <xsl:param name="EntityID">
        <xsl:value-of select="/root/Runtime/EntityID" />
      </xsl:param>
      <xsl:param name="WholesaleOnlySite">
        <xsl:value-of select="aspdnsf:AppConfigBool('WholesaleOnlySite')"/>
      </xsl:param>

      <xsl:param name="BaseURL">
        <xsl:choose>
          <xsl:when test="aspdnsf:StrToLower(/root/Runtime/EntityName) = 'category'">c-<xsl:value-of select="/root/Runtime/EntityID" />-<xsl:value-of select="/root/QueryString/sename" />.aspx</xsl:when>
          <xsl:when test="aspdnsf:StrToLower(/root/Runtime/EntityName) = 'section'">s-<xsl:value-of select="/root/Runtime/EntityID" />-<xsl:value-of select="/root/QueryString/sename" />.aspx</xsl:when>
          <xsl:when test="aspdnsf:StrToLower(/root/Runtime/EntityName) = 'manufacturer'">m-<xsl:value-of select="/root/Runtime/EntityID" />-<xsl:value-of select="/root/QueryString/sename" />.aspx</xsl:when>
          <xsl:when test="aspdnsf:StrToLower(/root/Runtime/EntityName) = 'library'">l-<xsl:value-of select="/root/Runtime/EntityID" />-<xsl:value-of select="/root/QueryString/sename" />.aspx</xsl:when>
        </xsl:choose>
      </xsl:param>

      <xsl:param name="CurrentPage">
        <xsl:choose>
          <xsl:when test="/root/QueryString/pagenum"><xsl:value-of select="/root/QueryString/pagenum" /></xsl:when>
          <xsl:otherwise>1</xsl:otherwise>
        </xsl:choose>
      </xsl:param>



      <xsl:template match="/">
        <div>
          <xsl:value-of select="aspdnsf:EntityPageHeaderDescription($EntityName, $EntityID)" disable-output-escaping="yes" />
        </div>
        <xsl:value-of select="aspdnsf:EntityPageFilterOptions($EntityName, $EntityID, /root/Runtime/SecID, /root/Runtime/CatID, /root/Runtime/ManID, /root/Runtime/ProductTypeFilterID)" disable-output-escaping="yes" />

        <xsl:call-template name="SubEntity" />
        <xsl:choose>
          <xsl:when test="count(/root/Products/Product) = 0 and count(/root/EntityHelpers/*[name()=/root/Runtime/EntityName]/descendant::Entity[EntityID=/root/Runtime/EntityID]/Entity) = 0">
            <xsl:value-of select="aspdnsf:Topic(concat('empty', /root/Runtime/EntityName, 'text'))" disable-output-escaping="yes" />
          </xsl:when>
          <xsl:otherwise>
            <div style="text-align:right;">
              <xsl:value-of select="aspdnsf:PagingControl($BaseURL, $CurrentPage, /root/Products2/Product/pages)" disable-output-escaping="yes" />
            </div>
            <table border="0" cellpadding="5" cellspacing="4" width="100%">
              <xsl:apply-templates select="/root/Products/Product" />
            </table>
            <div style="text-align:right;">
              <xsl:value-of select="aspdnsf:PagingControl($BaseURL, $CurrentPage, /root/Products2/Product/pages)" disable-output-escaping="yes" />
            </div>
			<br />
			<td valign="top" align="left">
			<div class="navHeader">You might also like</div>
			<table width="100%" cellspacing="0" cellpadding="4" border="0" style="border-style: solid; border-width: 1px; border-color: #444444;">
        <tbody><tr>
          <td align="left" class="RelatedProductsBoxStyle">
            <p><b></b></p>
            </td></tr><tr><td height="50px"><h3>Get Your Aeronautical Certificate Framed!</h3></td><td><h3>Get Your Commissioning Orders Framed!</h3></td></tr><tr>
              <td class="productcontainer" align="center" width="50%"><a href="p-1938-aeronautical-certificate.aspx"><img border="0" src="images/PRODUCT/icon/ac.jpg" style="cursor:hand;cursor:pointer;" name="ProductPic1938" id="ProductPic1938" /></a><br /><a href="p-1938-aeronautical-certificate.aspx">Aeronautical Certificate</a><br /></td>
              <td class="productcontainer" align="center" width="50%"><a href="p-1933-commissioning-orders.aspx"><img id="ProductPic1933" name="ProductPic1933" style="cursor:hand;cursor:pointer;" src="images/PRODUCT/icon/comm.jpg" border="0" /></a><br /><a href="p-1933-commissioning-orders.aspx">Commissioning Orders</a><br /></td>
            </tr>
			<tr>
			<td>Upon Graduation you receive this most important certificate â€“ now you are a pilot.  Of course, you want the framing on your "I love me" wall to match and so we offer all the framing and matting choices that are available to you with your Class Patch Prints.</td>
			<td valign="top">Additionally, when you entered service prior to attending UPT you received your Initial Commissioning Orders.  We offer the same frame and matting service for these orders so that you can complete your "I love me" wall.</td>
			</tr>
			<tr><td><h3>Where it all began!</h3></td><td><h3>Personalize your print even more!</h3></td></tr>
			<tr><td class="productcontainer" align="center" width="50%" valign="top"><a href="p-1650-da-20c-eclipse.aspx" class="productimage"><img id="ProductPic1555" name="ProductPic1555" style="cursor:hand;cursor:pointer;" src="images/PRODUCT/icon/552.jpg" border="0" /></a><br /><a href="p-1650-da-20c-eclipse.aspx">DA-20C "Eclipse"</a><br /><strong>Pueblo Memorial Airport, CO</strong><br />1st Flying Training Squadron, 306th Flying Training Group<br />Print#: 552</td><td  class="productcontainer" align="center">Make sure you add an engraved plate to your framed order to further customize your print!<br /><a href="p-1283-engraved-plate.aspx"><img border="0" id="ProductPic1283" name="ProductPic1283" src="images/PRODUCT/icon/plaque.jpg" /></a><br /><a href="p-1283-engraved-plate.aspx">Engraved Plate</a></td></tr>
          
        
      </tbody></table>
    </td>
			
          </xsl:otherwise>
        </xsl:choose>
      </xsl:template>



      <xsl:template name="SubEntity">
        <xsl:for-each select="/root/EntityHelpers/*[name()=/root/Runtime/EntityName]/descendant::Entity[ParentEntityID=/root/Runtime/EntityID]">

          <xsl:choose>
            <xsl:when test="$ShowSubcatsInGrid = 'true'">
              <table border="0" cellpadding="0" cellspacing="4" width="100%">
                <xsl:if test="position() mod $SubcatGridCols = 1 or ($SubcatGridCols = 1)">
                  <tr>
                    <xsl:for-each select=". | following-sibling::*[position() &lt; $SubcatGridCols]">
                      <xsl:variable name="scName" select="aspdnsf:GetMLValue(Name)"></xsl:variable>

                      <xsl:call-template name="SubCatCell">
                        <xsl:with-param name="scName" select="$scName" />
                      </xsl:call-template>
                    </xsl:for-each>
                  </tr>
                  <tr>
                    <td height="10" colspan="{$SubcatGridCols}">&#0160;</td>
                  </tr>
                </xsl:if>
              </table>
            </xsl:when>
            <xsl:otherwise>
              <xsl:variable name="scName" select="aspdnsf:GetMLValue(Name)"></xsl:variable>

              <p align="left">
                &#0160;&#0160;&#0160;<img border="1">
                  <xsl:attribute name="src">
                    skins/skin_<xsl:value-of select="aspdnsf:SkinID()" />/images/redarrow.gif
                  </xsl:attribute>
                </img>&#0160;
                <a href="{aspdnsf:EntityLink(EntityID, SEName, $EntityName, 0, '')}">
                  <xsl:value-of select="$scName" disable-output-escaping="yes"/>
                </a>
              </p>
            </xsl:otherwise>
          </xsl:choose>
        </xsl:for-each>
      </xsl:template>


      <xsl:template name="SubCatCell">
        <xsl:param name="scName"></xsl:param>
        <xsl:param name="URL">
          <xsl:value-of select="aspdnsf:EntityLink(EntityID, SEName, $EntityName, 0, '')" />
        </xsl:param>

        <td align="center">
          <a href="{$URL}">
            <xsl:value-of select="aspdnsf:LookupEntityImage(EntityID, $EntityName, 'icon', 0)" disable-output-escaping="yes" />
          </a>
          <br/>
          <a href="{$URL}">
            <xsl:value-of select="$scName" disable-output-escaping="yes"/>
          </a>
        </td>

      </xsl:template>


      <xsl:template match="Product">

        <xsl:if test="position() mod $SubcatGridCols = 1">
          <tr>
            <xsl:for-each select=". | following-sibling::*[position() &lt; $SubcatGridCols]">
              <xsl:call-template name="ProductCell"></xsl:call-template>
            </xsl:for-each>
          </tr>
        </xsl:if>

      </xsl:template>


      <xsl:template name="ProductCell">

        <xsl:param name="pName2" select="aspdnsf:GetMLValue(Name)"></xsl:param>
        <!-- Parmater for display of Base and Squadron -->


        <td align="center" class="productcontainer">
          <a href="{aspdnsf:ProductandEntityLink(ProductID, SEName, $EntityID, $EntityName, 0)}" class="productimage">
            <xsl:value-of select="aspdnsf:LookupImage(ProductID, 'product', 'icon', 1)" disable-output-escaping="yes"/>
          </a>
          <br/>
          <a href="{aspdnsf:ProductandEntityLink(ProductID, SEName, $EntityID, $EntityName, 0)}">
            <xsl:value-of select="$pName2" disable-output-escaping="yes"/>
          </a>
          <br />
          <!-- Code for display of Base and Squadron -->
          <DIV class="productlistbox">
            <xsl:variable name="pID" select="ProductID" />
            <STRONG>
              <xsl:value-of select="ParentSectionName" />&#160;
            </STRONG>
            <br />
            <xsl:value-of select="SectionName" />
            <br />
            <I>
              Print#: <xsl:value-of select="SKU" />
            </I>
          </DIV>
        </td>
      </xsl:template>
    </xsl:stylesheet>
  </PackageTransform>
</package>
